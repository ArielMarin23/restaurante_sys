{% extends "base.html" %}
{% block mi_css %}
<style>
   .pagination .page-item.active .page-link {
    background-color: #007bff;
    color: white;
}

</style>
{% endblock %}
{% block contenido_principal %}
<!-- contenido de cabezera (cabezera de pagina) -->
 <section class="content-header">
    <div class="container-fluid">
        <div class="row mb-2">
            <div class="col-sm-6">
                <h1>Referencial Ciudad</h1>
            </div>
            <div class="col-sm-6">
                <ol class="breadcrumb float-sm-right">
                    <li class="breadcrumb-item"><a href="{{url_for('inicio.index')}}">Inicio</a></li>
                    <li class="breadcrumb-item active">Referencial Ciudad</li>
                </ol>
            </div>
        </div>
    </div>
</section>
<!-- Inicio del cuerpo de tarjeta style="max-width: 600px; margin: auto;"-->
<section class="content">
    <div class="container-fluid">
        <div class="row">
            <div class="col-md-6">
                <div class="card">
                    <!-- cabecera de la card -->
                    <div class="card-header">
                        <div class="row">
                            <div class="col-sm-6"><h6 class="card-title">Ciudad</h6></div>
                            <div class="col-sm-6"><a href="#" class="btn btn-primary agregar-btn">Agregar Ciudad</a></div>
                        </div>
                    </div>
                    <!--Fin cabecera de la card -->
                    <!-- Inicio cuerpo de card-->
                    {% if ciudades|length > 0 %}
                    <div class="card-body p-0">
                        <table class="table" id="tbl">
                            <thead>
                                <tr>
                                    <th scope="col">#</th>
                                    <th scope="col">Descripcion</th>
                                    <th scope="col">Acciones</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for ciudad in ciudades %}
                                    <tr>
                                        <td scope="row">{{ ciudad['id'] }}</td> 
                                        <td>{{ ciudad['descripcion']}}</td>
                                        <td>
                                        <a href="#" class="btn btn-primary editar-btn">Editar</a>
                                        <a href="#" class="btn btn-warning">Eliminar</a>
                                        </td>
                                    </tr>
                                {% endfor %}
                            </tbody>
                        </table> 
                        
                    </div>
                    <div class="card-footer clearfix">
                        <ul class="pagination pagination-sm m-0 float-right" id="pagination-controls">
                            <li class="page-item previous-page"><a class="page-link" href="#">&laquo;</a></li>
                            <!-- Las páginas se generarán dinámicamente -->
                            <li class="page-item next-page"><a class="page-link" href="#">&raquo;</a></li>
                        </ul>
                    </div>
                    {% else %}
                    <div class="alert alert-info" role="alert">
                        No hay elementos para mostrar
                    </div>
                    {% endif %} 
            </div> 
        </div>
        <div class="col-md-6" id="editar-card-container">
            <!-- Aquí se insertará la nueva card cuando se haga clic en 'Editar' -->
        </div>
    </div>   
    
</section>
<!-- Fin cuerpo de card-->
{% endblock %}

{% block mi_javascript %}
<script>
$(document).ready(function(){
    //es una funcion reutilizable para evitar repetir codigo
    function cargarVista(url) {
        $.ajax({
            url: url,
            type: "GET",
            //data: { id: ciudadId }, // Pasar el ID de la ciudad como parámetro
            success: function(response){
                $('#editar-card-container').html(response);
            },
            error: function(xhr){
                console.error("Error al cargar la vista: ", xhr.responseText);
            }
        });
    }
    //final de funciona de carga de vista
    //Funcion que Maneja el clic en el boton de editar
    $('.editar-btn').click(function(){
        cargarVista("{{ url_for('ciudad.editar_ciudad')}}");
    });
    //Funcion que maneja el click en el boton de agregar
    $('.agregar-btn').click(function(){
        cargarVista("{{ url_for('ciudad.agregar_ciudad') }}");
    });
});

$(document).ready(function() {
    const rowsPerPage = 5;  // Número de filas por página
    const rows = $('#tbl tbody tr');
    const totalRows = rows.length;
    const totalPages = Math.ceil(totalRows / rowsPerPage);
    let currentPage = 1;  // Página inicial

    // Función para mostrar una página específica
    function showPage(page) {
        rows.hide();  // Ocultar todas las filas
        const start = (page - 1) * rowsPerPage;
        const end = start + rowsPerPage;
        rows.slice(start, end).show();  // Mostrar solo las filas de la página actual

        // Actualizar controles de paginación
        $('.pagination .page-item').removeClass('active');
        $('.pagination .page-item').eq(page).addClass('active');
    }

    // Crear controles de paginación dinámicamente
    function createPagination() {
        for (let i = 1; i <= totalPages; i++) {
            $('<li class="page-item"><a class="page-link" href="#">' + i + '</a></li>').insertBefore('.next-page');
        }
        $('.pagination .page-item').eq(1).addClass('active');  // Activar el primer botón de página
    }

    // Manejo de clics en los botones de paginación
    $('#pagination-controls').on('click', '.page-link', function(e) {
        e.preventDefault();
        const pageText = $(this).text();

        if (pageText === '«') {
            if (currentPage > 1) {
                currentPage--;
            }
        } else if (pageText === '»') {
            if (currentPage < totalPages) {
                currentPage++;
            }
        } else {
            currentPage = parseInt(pageText);  // Ir a la página seleccionada
        }
        showPage(currentPage);
    });

    // Inicializar la paginación
    createPagination();
    showPage(1);  // Mostrar la primera página por defecto
});
</script>

{% endblock %}
